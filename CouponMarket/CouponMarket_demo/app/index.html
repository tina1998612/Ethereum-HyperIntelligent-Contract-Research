<!DOCTYPE html>
<html>

<head>
  <title>MetaCoin - Truffle Webpack Demo w/ Frontend</title>
  <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
  <script src="./app.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <!-- Latest compiled and minified CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u"
    crossorigin="anonymous">

  <!-- Optional theme -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp"
    crossorigin="anonymous">

  <!-- Latest compiled and minified JavaScript -->
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
    crossorigin="anonymous"></script>
</head>

<style>
  .parent-vertical-centralized {
    display: flex;
    flex-direction: column;
    justify-content: center;
  }
</style>

<body>
  <div class="container">

    <div class="row">
      <form id="create_coupon_form">
        <div class="form-group col-md-3">
          <label for="value" class="control-label">Value</label>
          <input type="text" value='' class="form-control" id="value" placeholder="100">
        </div>
        <div class="form-group col-md-3">
          <label for="startTime" class="control-label">Start time</label>
          <input type="text" value='' class="form-control" id="startTime" placeholder="0">
        </div>
        <div class="form-group col-md-3">
          <label for="endTime" class="control-label">End time</label>
          <input type="text" value='' class="form-control" id="endTime" placeholder="10">
        </div>
        <div class="form-group col-md-3 parent-vertical-centralized">
          <label for="create_coupon" class="control-label" style="color:white">none</label>
          <input class="btn btn-outline-primary" type="button" name="submit" id="create_coupon" value="Create coupon">
        </div>
      </form>
    </div>


    <div class="row">
      <form id="transfer_coupon_form">
        <div class="form-group col-md-3">
          <label for="value" class="control-label">Coupon ID</label>
          <input type="text" value='' class="form-control" id="id" placeholder="1">
        </div>
        <div class="form-group col-md-3">
          <label for="startTime" class="control-label">Owner</label>
          <input type="text" value='' class="form-control" id="owner" placeholder="0">
        </div>
        <div class="form-group col-md-3">
          <label for="startTime" class="control-label">Receiver</label>
          <input type="text" value='' class="form-control" id="receiver" placeholder="accounts[1]">
        </div>
        <div class="form-group col-md-3 parent-vertical-centralized">
          <label for="transfer_coupon" class="control-label" style="color:white">none</label>
          <input class="btn btn-outline-primary" type="button" name="submit" id="transfer" value="Transfer coupon">
        </div>
      </form>
    </div>

    <div class="row">
      <form id="redeem_coupon_form">
        <div class="form-group col-md-3">
          <label for="value" class="control-label">Coupon ID</label>
          <input type="text" value='' class="form-control" id="id2" placeholder="1">
        </div>
        <div class="form-group col-md-3">
          <label for="startTime" class="control-label">Owner</label>
          <input type="text" value='' class="form-control" id="owner" placeholder="0">
        </div>
        <div class="form-group col-md-3 parent-vertical-centralized">
          <label for="transfer_coupon" class="control-label" style="color:white">none</label>
          <input class="btn btn-outline-primary" type="button" name="submit" id="redeem" value="Redeem coupon">
        </div>
      </form>
    </div>

    <br>

    <div id="coupons">

      <table class="table table-striped table-hover" id="coupon_info">
        <thead>
          <tr>
            <th>ID</th>
            <th>owner</th>
            <th>issuer</th>
            <th>value</th>
            <th>startTime</th>
            <th>endTime</th>
          </tr>
        </thead>
        <tbody>

        </tbody>
      </table>

    </div>

    <span id="status"></span>

  </div>

  <script>
    var accounts;
    $('#create_coupon').click(async function () {
      console.log('create coupon btn clicked!');
      var value = $('#value').val() || 100;
      var startTime = $('#startTime').val() || 0;
      var endTime = $('#endTime').val() || 10;
      var coupon_info = await App.newCoupon(value, startTime, endTime);
      $('#coupon_info > tbody:last-child').append(`
        <tr>
          <td>`+ coupon_info.ID + `</td>
          <td>`+ coupon_info.owner + `</td>
          <td>`+ coupon_info.issuer + `</td>
          <td>`+ coupon_info.value + `</td>
          <td>`+ coupon_info.startTime + `</td>
          <td>`+ coupon_info.endTime + `</td>
        </tr>
        `);
      console.log(coupon_info);
      return false;
    });
    $('#transfer').click(async function () {
      console.log('transfer btn clicked!');

      accounts = await App.getAccs();
      var couponID = $('#id').val() || 1;
      var receiver = $('#receiver').val() || accounts[1];
      var success = await App.transfer(couponID, receiver);
      console.log(success);
    });
    $('#redeem').click(async function () {
      console.log('transfer btn clicked!');

      accounts = await App.getAccs();
      var couponID = $('#id2').val() || 1;
      var success = await App.redeem(couponID);
      console.log(success);
    });

  </script>
</body>

</html>